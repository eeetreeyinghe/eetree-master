(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{4:function(o,t,r){o.exports=r("W4zP")},W4zP:function(o,t){function r(o){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}var n;n=jQuery,new function(o){var t=o.docDraft.content;n(".doc-share").click((function(){axios({method:"post",url:o.docDraft.setShareUrl}).then((function(t){Modal.alert({title:"分享成功",msg:'<input  id="shareLink" class="copy-cont" value="'+o.docDraft.shareUrl+'" readonly="readonly" /><input class="btn btn-primary" type="button" onclick="copyurl()" value="点击复制">'})}))})),n(".doc-save").click((function(){i("manual")})),jQuery.validator.setDefaults({errorElement:"span",errorPlacement:function(o,t){o.addClass("help-block"),t.parent("div").append(o)},highlight:function(o,t,r){n(o).parent("div").addClass("has-error")},unhighlight:function(o,t,r){n(o).parent("div").removeClass("has-error")}}),n(".doc-lock").click((function(){o.docDraft.doc_id?axios({method:"put",url:o.docDraft.lockUrl}).then((function(o){toastr.success("操作成功"),n(".doc-lock").toggleClass("hide")})):n(".doc-publish").trigger("click")})),n(".doc-publish").click((function(){i("silence");var t="";o.docDraft.doc_id>0&&(t='<div class="form-group row">                    <label for="docHistory" class="col-sm-2 col-form-label">修订说明</label>                    <div class="col-sm-10">                        <textarea class="form-control" id="docHistory" name="docHistory" placeholder="请填写您的文档修订说明，10到100个字符" rows="3"></textarea>                    </div>                </div>');var r="发布需要管理员审核，审核通过后即会公开文档";"cv"==o.docDraft.type&&(r="发布需要管理员审核"),Modal.confirm({title:"确认",msg:'<form id="publishDoc"><div class="text-muted" style="margin-bottom: 10px;">'+r+'</div>                <div class="form-group row">                    <label for="docDescription" class="col-sm-2 col-form-label">描述</label>                    <div class="col-sm-10">                        <textarea class="form-control" id="docDescription" name="docDescription" placeholder="请填写您的文档描述，10到100个字符" rows="3">'+o.docDraft.desc+"</textarea>                    </div>                </div>"+t+"</form>"}).on((function(r){r.stopPropagation();var e={docDescription:{required:!0,minlength:10,maxlength:100,normalizer:function(o){return n.trim(o)}}};if(""!=t&&(e.docHistory={required:!0,minlength:10,maxlength:100,normalizer:function(o){return n.trim(o)}}),!n("#publishDoc").validate({rules:e}).form())return!1;var i={description:n.trim(n("#docDescription").val())};""!=t&&(i.edit_history=n.trim(n("#docHistory").val())),axios({method:"post",url:o.docDraft.publishUrl,data:i}).then((function(o){toastr.success("发布成功，待管理员审核"),Modal.close()}))}))}));var e=!1;function i(r){var i=minder.exportJson(),c=JSON.stringify(i);c==t||e?"manual"==r&&toastr.info("未改动"):(e=!0,n.ajax({async:!1,type:"put",url:o.docDraft.saveUrl,data:{content:c},success:function(o){e=!1,t=c,"manual"==r?toastr.success("保存成功"):"silence"==r||toastr.success("已保存")},error:function(o,t,r){e=!1}}))}angular.module("editDocApp",["kityminderEditor"]).config(["configProvider",function(t){t.set("imageUpload",o.docDraft.uploadUrl)}]).controller("MainController",["$scope",function(n){n.initEditor=function(n,e){window.editor=n,window.minder=e,"object"==r(t)?(e.importJson(t),t=JSON.stringify(t)):(e.select(e.getRoot(),!0),e.execCommand("text",o.docDraft.title),i("silence"))}}]),setInterval(i,1e4),window.onbeforeunload=function(){i()},window.onunload=function(){i()}}(pageOptions)}},[[4,0]]]);